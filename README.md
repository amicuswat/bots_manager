# Bot manager

Это приложение предоставляет интерфес для настройки бота, рассылающего оповещения о балансе Frigate.

## Запуск приложения

- Скачайте код;
- Установите зависимости командой `pip install -r requirements.txt`;
- Отконфигурируйте БД командой `python3 manage.py migrate`. Для использования БД Postgres необходимо, 
чтобы настройки подключения к базе были добавлены в переменные окружения. Необходимые переменные окружения перечисленны в 
соответствующем разделе;
- Создайте учетную запись администратора командой `python3 manage.py createsuperuser`. Логин и пароль, которые вы при этом
укажете, будут использоваться для доступа в интерфейс управления ботом;
- Запустите сервер командой `python3 manage.py runserver`.

## Переменные окружения

Чтобы упростить ввод переменных окружения, создайте файл `.env` в одной директории с `manage.py` и запишите туда данные в формате: `ПЕРЕМЕННАЯ=значение`.

Базовые переменные:
- `DEBUG` — дебаг-режим. Поставьте True, чтобы увидеть отладочную информацию в случае ошибки.
- `SECRET_KEY` — секретный ключ, подойдет любой набор случайных символов.
- `ALLOWED_HOSTS` — для локального запуска можно указать `localhost` или `127.0.0.1`.

Настройки подключения к БД Postgres. Если они не будут указаны, приложение создаст базу данных SQLight.
- `DB_NAME` — имя БД (пустая база данных должна быть предварительно создана);
- `DB_USER` — имя пользователя, с правами которого приложение будет подключаться к БД;
- `DB_PASSWORD` — пароль пользователя, с правами которого приложение будет подключаться к БД;
- `DB_HOST` — имя хоста, на котором запущен сервер Postgres;
- `DB_PORT` — порт, на котором сервер Postgres принимает запросы к БД.

## Использование

Перейти в интерфейс администратора можно по адресу `http://localhost:8000/admin/`, если приложение запущено локально.
В интерфейсе администратора в разделе `MANAGE_BOTS` доступны три вкладки: `Балансы`, `Боты`, `ТГ группы`.

Вкладка `Балансы` содержит историю баланса Frigate. Данные в нее добавляет непосредтсвенно сам бот.

Вкладка `Боты` содержит пресеты настройек для бота. Доступны следующие настройки:
- Первый порог срабатывания автоматики (баланс, ниже которого бот начинает уведомлять о необходимости оплаты);
- Повторное уведомление при первом пороге (временной интервал, с которым отправляются уведомления о балансе ниже первого порога);
- Второй порог срабатывания автоматики (баланс, ниже которого бот начинает отправлять более частые уведомления о необходимости оплаты);
- Повторное уведомление при втором пороге (временной интервал, с которым отправляются уведомления о балансе ниже второго порога);
- Частота запроса баланса по АПИ (временной интервал, с которым отправляются бот запрашивает информацию о балансе от API Frigate);

Вкладка `ТГ группы` содержит данные о группах Телеграм, в которых разрешено использование функционала бота. Доступны следующие параметры:
- Название группы;
- ID группы в Телеграм;
- Получает уведомление - этот параметр указывает, будут ли в данную группу отправляться уведомления о падении баланса ниже указанного
в настройках бота порога.